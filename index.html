<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Canvas Game – Sprites & Colisão</title>

  <style>
    body {
      margin: 0;
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    canvas {
      border: 2px solid #000;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth
    canvas.height = window.innerHeight

    /* =======================
       CONFIGURAÇÕES
    ======================= */
    const maxLife = 100;
    let life = 100;
    let displayedLife = 100;


    /* =======================
       SOUND EFFECTS
    ======================= */
    const hitSound = new Audio('./assets/sounds/quick-cut.mp3')
    const deathSound = new Audio('./assets/sounds/death-scream.wav')
    hitSound.volume = 0.6;
    deathSound.volume = 0.8;

    /* =======================
       SPRITE
    ======================= */
    const sprite = new Image();
    sprite.src = "./assets/dragon-sprite.png";

    const player = {
      x: canvas.width / 2,
      y: canvas.height - 100,
      width: 100,
      height: 100,
      frame: 0,
      frameCount: 3,
      frameSpeed: 0.05,
      frameTimer: 0
    };

    /* =======================
       BACKGROUND
    ======================= */
    function drawBackground() {
      ctx.fillStyle = "#87ceeb";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, canvas.height - 115, canvas.width, 115);
    }

    /* =======================
       LIFE BAR
    ======================= */
    function drawLifeBar() {
      const x = 20, y = 20, w = 200, h = 20;

      displayedLife += (life - displayedLife) * 0.1;

      ctx.fillStyle = "#444";
      ctx.fillRect(x, y, w, h);

      ctx.fillStyle = "#ff0000";
      ctx.fillRect(x, y, (displayedLife / maxLife) * w, h);

      ctx.strokeStyle = "#000";
      ctx.strokeRect(x, y, w, h);
    }

    /* =======================
       PLAYER
    ======================= */
    function updatePlayer() {
      player.frameTimer += player.frameSpeed;
      if (player.frameTimer >= 1) {
        player.frame = (player.frame + 1) % player.frameCount;
        player.frameTimer = 0;
      }
    }

    function drawPlayer() {
      ctx.drawImage(
        sprite,
        player.frame * player.width,
        0,
        player.width,
        player.height,
        player.x - player.width / 2,
        player.y - player.height,
        player.width,
        player.height
      );

      // DEBUG HITBOX (opcional)
      ctx.strokeStyle = "transparent";

      ctx.strokeRect(
        player.x - player.width / 2,
        player.y - player.height,
        player.width,
        player.height
      );
    }

    function endGame() {
      // ... 
    }

    /* =======================
       COLISÃO POR CLIQUE
    ======================= */
    canvas.addEventListener("click", (event) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = event.clientX - rect.left;
      const mouseY = event.clientY - rect.top;

      const hitbox = {
        x: player.x - player.width / 2,
        y: player.y - player.height,
        w: player.width,
        h: player.height
      };

      const collided =
        mouseX >= hitbox.x &&
        mouseX <= hitbox.x + hitbox.w &&
        mouseY >= hitbox.y &&
        mouseY <= hitbox.y + hitbox.h;

      if (collided) {
        life -= 10;
        if (life < 0) life = 0;
      }

      if (life !== 0) {
        hitSound.currentTime = 0;
        hitSound.play();
      }

      if (life === 0) {
        deathSound.currentTime = 0;
        deathSound.play();

        endGame()
      }
    });

    /* =======================
       GAME LOOP
    ======================= */
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawBackground();
      drawLifeBar();
      updatePlayer();
      drawPlayer();

      requestAnimationFrame(gameLoop);
    }

    sprite.onload = () => {
      gameLoop();
    };
  </script>

</body>

</html>